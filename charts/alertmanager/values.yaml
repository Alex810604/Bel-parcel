image:
  repository: prom/alertmanager
  tag: v0.26.0
  pullPolicy: IfNotPresent
service:
  port: 9093
config:
  global:
    resolve_timeout: 5m
  route:
    group_by: ['alertname', 'service']
    group_wait: 10s
    group_interval: 10s
    repeat_interval: 1h
    receiver: 'slack-notifications'
    routes:
      - match:
          severity: 'critical'
        receiver: 'critical-alerts'
  receivers:
    - name: 'slack-notifications'
      slack_configs:
        - api_url_file: '/etc/alertmanager/secrets/slack_webhook'
          channel: '#alerts'
          send_resolved: true
          title: '{{ template "slack.title" . }}'
          text: '{{ template "slack.text" . }}'
    - name: 'critical-alerts'
      slack_configs:
        - api_url_file: '/etc/alertmanager/secrets/slack_webhook'
          channel: '#critical-alerts'
          send_resolved: true
          title: '{{ template "slack.title" . }}'
          text: '{{ template "slack.text" . }}'
templates:
  slack.tmpl: |
    {{ define "slack.title" }}{{ .CommonAnnotations.summary }}{{ end }}
    {{ define "slack.text" }}{{ range .Alerts }}*{{ .Labels.alertname }}* {{ .Annotations.description }}{{ "\n" }}{{ end }}{{ end }}
secrets:
  slack_webhook: "https://hooks.slack.com/services/CHANGE/ME"
